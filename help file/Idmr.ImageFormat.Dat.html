<HTML>
<HEAD>
<TITLE>Dat Namespace (Idmr.ImageFormat)</TITLE>
<style type="text/css">a{color:#ccc} body{color:#666; background-color:#000} span{color:#088} h2,h3,h4{color:#aaa}</style>
</HEAD>

<BODY>
<h1>Dat Namespace</h1>
<u>Provides the classes required to work with LucasArts *.DAT image archives found in X-wing Alliance</u><BR><BR>
<B>Namespace:</B> Idmr.ImageFormat<BR>
<B>Assembly:</B> Idmr.ImageFormat.Dat.dll<BR>
<B>Additional References:</B><BR>
&nbsp;&nbsp;&nbsp;System.Drawing<br>
&nbsp;&nbsp;&nbsp;Idmr.Common<br>
<B>Version:</B> 2.0<BR>
<hr>

<div>
<h2>DatFile Class</h2>
<img src="images/class.gif"> <span><b>public</b> class</span> DatFile<br>
<u>Object to work with and create DAT archives</u>

<h3>Constructors</h3>

<p><img src="images/meth.gif"> <span><b>public</b></span> DatFile( )<br>
<u>Create a blank Dat archive</u>. FilePath defaults to "newfile.dat"</p>

<p><img src="images/meth.gif"> <span><b>public</b></span> DatFile(<span>string</span> file)<br>
<u>Loads an existing Dat archive</u><br>
<i>file</i> - Full path to the *.dat file<br>
<b>Exceptions</b><br>
<i>Idmr.Common.LoadFileException</i> - File cannot be loaded, check InnerException</p>

<h3>Methods</h3>

<p><img src="images/meth.gif"> <span><b>public</b> void</span> DecodeFile(<span>byte</span>[] rawData)<br>
<u>Populates the Dat with the raw byte data from file</u><br>
<i>rawData</i> - Entire contents of a *.DAT archive<br>
<b>Exceptions</b><br>
<i>System.ArgumentException</i> - Validation error</p>

<p><img src="images/static.gif"><img src="images/meth.gif"> <span><b>public</b> static</span> System.Drawing.<span>Bitmap</span> DecodeImage(<span>byte</span>[] rawData, <span>int</span> width, <span>int</span> height, System.Drawing.<span>Color</span>[] colors, <span>ImageType</span> type)<br>
<u>Gets the image from the given information</u><br>
<i>rawData</i> - Encoded Rows data<br>
<i>width</i> - Image width<br>
<i>height</i> - Image height<br>
<i>colors</i> - Defined Color array to be used for the image<br>
<i>type</i> - Encoding protocol used for <i>rawData</i></p>

<p><img src="images/static.gif"><img src="images/meth.gif"> <span><b>public</b> static byte</span>[] EncodeImage(System.Drawing.<span>Bitmap</span> image, <span>ImageType</span> type, System.Drawing.<span>Color</span>[] colors, <span><b>out</b></span> System.Drawing.<span>Bitmap</span> trimmedImage, <span><b>out</b></span> System.Drawing.<span>Color</span>[] trimmedColors)<br>
<u>Returns the encoded Rows data given the image and settings</u> - Unused color indexes are removed from both <i>colors</i> and <i>image</i>, the returned array reflects the trimmed parameters<br>
<i>image</i> - The image to encode<br>
<i>type</i> - The encoding protocol to use<br>
<i>colors</i> - The color array to use<br>
<i>trimmedImage</i> - <i>image</i> with unused color indexes removed<br>
<i>trimmedColors</i> - <i>colors</i> with unused color indexes removed<br>
<b>Exceptions</b><br>
<i>Idmr.Common.BoundaryException</i> - <i>image</i> exceeds allowable dimensions</p>

<p><img src="images/meth.gif"> <span><b>public</b> void</span> Save( )<br>
<u>Saves the Dat archive in its existing location</u><br>
<b>Exceptions</b><br>
<i>Idmr.Common.SaveFileException</i> - File cannot be saved, check InnerException for more details. Original file remains unchanged if applicable</p>

<p><img src="images/meth.gif"> <span><b>public</b> void</span> Save(<span>string</span> file)<br>
<u>Saves the Dat archive to a new location</u><br>
<i>file</i> - Full path to the new location<br>
<b>Exceptions</b><br>
<i>Idmr.Common.SaveFileException</i> - File cannot be saved, check InnerException for more details. Original file remains unchanged if applicable</p>

<h3>Properties</h3>

<p><img src="images/prop.gif"> <span><b>public</b> string</span> FileName<br>
<u>Gets the file name of the Dat object</u></p>

<p><img src="images/prop.gif"> <span><b>public</b> string</span> FilePath<br>
<u>Gets the full path to the dat object</u></p>

<p><img src="images/prop.gif"> <span><b>public</b> GroupCollection</span> Groups<br>
<u>Gets or sets the Collection of Groups in the archive</u></p>

<p><img src="images/const.gif"> <span><b>public</b> const short</span> MaximumHeight<br>
<u>Maximum allowable image height</u></p>

<p><img src="images/const.gif"> <span><b>public</b> const short</span> MaximumWidth<br>
<u>Maximum allowable image width</u></p>

<p><img src="images/prop.gif"> <span><b>public</b> int</span> NumberOfGroups<br>
<u>Gets the number of Groups in the archive</u></p>

<h3>Enumerations</h3>

<p><img src="images/enum.gif"> <span><b>public</b> enum</span> ImageType : <span>short</span> { Transparent = 7, Blended = 24, UncompressedBlended }<br>
<u>Types of image compression</u>. Transparent is 0-8bbp Indexed, transparent color is Color[0]. Blended is 0-16bpp Indexed Alpha compressed. UncompressedBlended is 16bpp Indexed Alpha uncompressed</p>

<h3>Structures</h3>

<p><img src="images/struct.gif"> <span><b>public</b> struct</span> Group<br>
<u>Container for a Group, acts as a simple wrapper for Subs</u><br>
<div style="margin-left: 25px">
  <h3>Constructors</h3>

  <p><img src="images/meth.gif"> <span><b>public</b></span> Group(<span>byte</span>[] header)<br>
  <u>Create a new Group according to the supplied header information</u><br>
  <i>header</i> - GroupHeader raw data<br>
  <b>Exceptions</b><br>
  <i>System.ArgumentException</i> - <i>header</i> is not the required length</p>

  <p><img src="images/meth.gif"> <span><b>public</b></span> Group(<span>SubCollection</span> subs)<br>
  <u>Create a new Group and populate with the given SubCollection</u><br>
  <i>subs</i> - Subs to be included in the Group</p>

  <p><img src="images/meth.gif"> <span><b>public</b></span> Group(<span>short</span> groupID)<br>
  <u>Create an empty Group with the given ID</u>. <i>Subs</i> is set to <i>null</i><br>
  <i>groupID</i> - Group ID value</p>

  <p><img src="images/meth.gif"> <span><b>public</b></span> Group(<span>short</span> groupID, System.Drawing.<span>Bitmap</span>[] images)<br>
  <u>Creates a new Group and populates it with the given images</u>. <i>Sub.SubID</i> values start at 0 and increment by 1. All images must be 8bppIndexed and are initialized as ImageType.Transparent. To use Blended images, Subs must individually have their Type changed and use SetTransparencyMask()<br>
  <i>groupID</i> - Group ID value<br>
  <i>images</i> - Images from which to create the Subs<br>
  <b>Exceptions</b><br>
  <i>System.ArgumentException</i> - Not all images are 8bppIndexed<br>
  <i>Idmr.Common.BoundaryException</i> - Not all images meet allowable dimensions</p>

  <h3>Properties</h3>

  <p><img src="images/prop.gif"> <span><b>public</b> short</span> ID<br>
  <u>Gets or Sets the Group Identifier</u>. Updating through GroupCollection.SetID( ) is preferred</p>

  <p><img src="images/prop.gif"> <span><b>public</b> int</span> NumberOfSubs<br>
  <u>Gets the number of Subs within the Group</u></p>

  <p><img src="images/prop.gif"> <span><b>public</b> SubCollection</span> Subs<br>
  <u>Gets or sets the Collection of Subs within the Group</u></p>
</div></p>

<p><img src="images/struct.gif"> <span><b>public</b> struct</span> Sub<br>
<u>Container for individual images</u><br>
<div style="margin-left: 25px">
  <h3>Constructors</h3>

  <p><img src="images/meth.gif"> <span><b>public</b></span> Sub(<span>byte</span>[] raw)<br>
  <u>Create a new Sub with the provided raw data</u><br>
  <i>raw</i> - GroupHeader raw data<br>
  <b>Exceptions</b><br>
  <i>System.ArgumentException</i> - Validation error</p>

  <p><img src="images/meth.gif"> <span><b>public</b></span> Sub(<span>short</span> groupID, <span>short</span> subID)<br>
  <u>Create an empty Sub</u>. Initialized as ImageType.Transparent. <i>Image</i> and <i>Colors</i> set to <i>null</i><br>
  <i>groupID</i> - Group ID value<br>
  <i>subID</i> - Sub ID value</p>

  <p><img src="images/meth.gif"> <span><b>public</b></span> Sub(<span>short</span> groupID, <span>short</span> subID, System.Drawing.<span>Bitmap</span> image)<br>
  <u>Create a new sub from the provided image and IDs</u>. <i>image</i> must be 8bppIndexed, 640x480 max. Initialized as ImageType.Transparent. If a Blended type is desired, change Type and SetTransparencyMask( )<br>
  <i>groupID</i> - Group ID value<br>
  <i>subID</i> - Sub ID value<br>
  <i>image</i> - The image to be used<br>
  <b>Exceptions</b><br>
  <i>System.ArgumentException</i> - <i>image</i> is not 8bppIndexed<br>
  <i>Idmr.Common.BoundaryException</i> - <i>image</i> exceeds allowable dimensions</p>

  <h3>Methods</h3>

  <p><img src="images/meth.gif"> <span><b>public</b> void</span> SetImage(System.Drawing.<span>Bitmap</span> image)<br>
  <u>Sets the image of the Sub</u>. <i>image</i> restricted to 640x480<br>
  <i>image</i> - The image to be used<br>
  <b>Exceptions</b></br>
  <i>System.ArgumentException</i> - Invalid <i>image</i> value</p>

  <p><img src="images/meth.gif"> <span><b>public</b> void</span> SetImage(System.Drawing.<span>Bitmap</span> image, System.Drawing.<span>Bitmap</span> mask)<br>
  <u>Sets the image and transparency of the Sub</u>. <i>image</i> restricted to 640x480. <i>mask</i>.Size must match <i>image</i>.Size, must be 8bppIndexed. 0 is transparent, 255 is solid.<br>
  <i>image</i> - The image to be used<br>
  <i>mask</i> - The transparency mask to be used. Ignored if Type = Transparent<br>
  <b>Exceptions</b><br>
  <i>System.ArgumentException</i> - Invalid <i>image</i> or <i>mask</i> values</p>

  <p><img src="images/meth.gif"> <span><b>public</b> void</span> SetTransparencyMask(System.Drawing.<span>Bitmap</span> mask)<br>
  <u>Sets the transparency of the Sub for Blended types</u>. <i>mask</i>.Size must match <i>Image</i>.Size, must be 8bppIndexed. Index 0 is transparent, 255 is solid. Typically a grayscale image, 0 being black and 255 as white.<br>
  <i>mask</i> - The transparency mask to be used<br>
  <i>System.ArgumentException</i> - Invalid <i>mask</i> value</p>

  <h3>Properties</h3>

  <p><img src="images/prop.gif"> <span><b>public</b></span> System.Drawing.<span>Color</span>[] Colors<br>
  <u>Collection of colors defined by the Sub</u></p>

  <p><img src="images/prop.gif"> <span><b>public</b> short</span> GroupID<br>
  <u>Gets or sets the ID of the parent Group</u></p>

  <p><img src="images/prop.gif"> <span><b>public</b> short</span> Height<br>
  <u>Gets the height of the image</u></p>

  <p><img src="images/prop.gif"> <span><b>public</b></span> System.Drawing.<span>Bitmap</span> Image<br>
  <u>Gets the image of the Sub</u></p>

  <p><img src="images/prop.gif"> <span><b>public</b> int</span> NumberOfColors<br>
  <u>Gets the number of colors defined in the Sub</u></p>

  <p><img src="images/prop.gif"> <span><b>public</b> short</span> SubID<br>
  <u>Gets or sets the ID of the Sub</u></p>

  <p><img src="images/prop.gif"> <span><b>public</b> ImageType</span> Type<br>
  <u>Gets or sets the format of the raw byte data</u>. Transparency data is lost when going to ImageType.Transparent</p>
</div></p>
</div>
<hr>

<div>
<h2>GroupCollection class</h2>
<img src="images/class.gif"> <span><b>public</b> class</span> GroupCollection<br>
<u>Object to maintain Dat archive Groups</u>

<h3>Constructors</h3>

<p><img src="images/meth.gif"> <span><b>public</b></span> GroupCollection( )<br>
<u>Creates an empty Collection</u></p>

<p><img src="images/meth.gif"> <span><b>public</b></span> GroupCollection(<span>int</span> quantity)<br>
<u>Creates a Collection with multiple initial Groups</u>. Individual Groups remain uninitialized<br>
<i>quantity</i> - Number of Groups to start with<br>
<b>Exceptions</b><br>
<i>System.ArgumentException</i> - <i>quantity</i> is not positive</p>

<p><img src="images/meth.gif"> <span><b>public</b></span> GroupCollection(DatFile.<span>Group</span>[] groups)<br>
<u>Creates a Collection and populates it with the provided Groups</u>. Groups will be sorted by ascending ID<br>
<i>groups</i> - Initial Groups</p>

<h3>Methods</h3>

<p><img src="images/meth.gif"> <span><b>public</b> int</span> Add(<span>short</span> groupID)<br>
<u>Adds an empty Group with the given ID. Returns the index of the Group within the Collection</u>. Group is added and then the Collection is sorted by ascending ID<br>
<i>groupID</i> - ID value for the new Group<br>
<b>Exceptions</b><br>
<i>System.ArgumentException</i> - <i>groupID</i> is already in use</p>

<p><img src="images/meth.gif"> <span><b>public</b> int</span> Add(<span>short</span> groupID, System.Drawing.<span>Bitmap</span>[] images)<br>
<u>Adds a Group with the given ID and Subs created from <i>images</i>. Returns the index of the Group within the Collection</u>. Group is added and then the Collection is sorted by ascending ID. <i>images</i> must all be 8bppIndexed and are initialized as ImageType.Transparent. To use Blended images, Subs must individually have their Type changed and use SetTransparencyMask( )<br>
<i>groupID</i> - ID value for the new Group<br>
<i>images</i> - Images from which to create the Subs<br>
<b>Exceptions</b><br>
<i>System.ArgumentException</i> - <i>groupID</i> is already in use, or <i>images</i> are not all 8bppIndexed</p>

<p><img src="images/meth.gif"> <span><b>public</b> int</span> Add(<span>SubCollection</span> subs)<br>
<u>Adds a Group populated with the given Collection of Subs. Returns the index of the Group within the Collection</u>. Group is added and then the Collection is sorted by ascending SubID<br>
<i>subs</i> - Subs to be included in the Group<br>
<b>Exceptions</b><br>
<i>System.ArgumentException</i> - Group.ID is already in use</p>

<p><img src="images/meth.gif"> <span><b>public</b> int</span> Add(DatFile.<span>Group</span> group)<br>
<u>Adds a Group to the Collection. Returns the index of the Group within the Collection</u>. Group is added and then the Collection is sorted by ascending SubID<br>
<i>group</i> - Group to be added<br>
<b>Exceptions</b><br>
<i>System.ArgumentException</i> - Group.ID is already in use</p>

<p><img src="images/meth.gif"> <span><b>public</b> void</span> Clear( )<br>
<u>Empties the Collection of entries</u>. All existing Groups are lost, Count is set to zero</p>

<p><img src="images/meth.gif"> <span><b>public</b> bool</span> Remove(<span>int</span> index)<br>
<u>Deletes the specified Group from the Collection. Returns <i>true</i> if successful, <i>false</i> for invalid <i>index</i> value</u>. If only Group is specified, executes Clear( )<br>
<i>index</i> - Group index</p>

<p><img src="images/meth.gif"> <span><b>public</b> bool</span> RemoveById(<span>short</span> groupID)<br>
<u>Deletes the Group with the specified ID. Returns <i>true</i> if successful, <i>false</i> for invalid <i>groupID</i> value</u>. If only Group is specified, executes Clear( )<br>
<i>groupID</i> - The ID of the Group to be deleted</p>

<p><img src="images/meth.gif"> <span><b>public</b> int</span> SetGroupID(<span>short</span> groupID, <span>short</span> newID)<br>
<u>Updates the Group.ID. Returns the index of the updated Group within the Collection</u>. Group.ID is updated and then the Collection is sorted by ascending ID. This is the preferred method for updating Group IDs<br>
<i>groupID</i> - The existing Group.ID<br>
<i>newID</i> - The new Group.ID<br>
<b>Exceptions</b><br>
<i>System.ArgumentException</i> - <i>newID</i> is already in use or <i>groupID</i> does not exist</p>

<p><img src="images/meth.gif"> <span><b>public</b> int</span> GetIndex(<span>short</span> groupID)<br>
<u>Gets the Collection index of the Group with the provided ID. Returns Collection index if <i>groupID</i> exists, otherwise -1</u><br>
<i>groupID</i> - Group ID value</p>

<h3>Properties</h3>

<p><img src="images/prop.gif"> <span><b>public</b></span> DatFile.<span>Group <b>this</b></span>[<span>int</span> index]<br>
<u>A single Group within the Collection</u></p>

<p><img src="images/prop.gif"> <span><b>public</b> int</span> Count<br>
<u>Gets the number of objects in the Collection</u></p>

<p><img src="images/prop.gif"> <span><b>public</b> int</span> NumberOfColors<br>
<u>Gets the total number of colors defined in the Collection</u>. Equals the sum of <i>this[].NumberOfColors</i> values</p>

<p><img src="images/prop.gif"> <span><b>public</b> short</span> NumberOfSubs<br>
<u>Gets the total number of Subs defined in the file</u>. Equals the sum of <i>Groups[].NumberOfSubs</i> values</p>
</div>
<hr>

<div>
<h2>SubCollection class</h2>
<img src="images/class.gif"> <span><b>public</b> class</span> SubCollection<br>
<u>Object to maintain Dat archive Subs</u>

<h3>Constructors</h3>

<p><img src="images/meth.gif"> <span><b>public</b></span> SubCollection(<span>short</span> groupID)<br>
<u>Creates an empty Collection</u><br>
<i>groupID</i> - ID value of the parent Group</p>

<p><img src="images/meth.gif"> <span><b>public</b></span> SubCollection(<span>int</span> quantity, <span>short</span> groupID)<br>
<u>Creates a Collection with multiple initial Subs</u>. Individual Subs are created with <i>groupID</i> and SubIDs starting from zero. Sub colors and images remain uninitialized<br>
<i>quantity</i> - Number of Groups to start with<br>
<i>groupID</i> - ID value of the parent Group<br>
<b>Exceptions</b><br>
<i>System.ArgumentException</i> - <i>quantity</i> is not positive</p>

<p><img src="images/meth.gif"> <span><b>public</b></span> SubCollection(<span>short</span> groupID, System.Drawing.<span>Bitmap</span>[] images)<br>
<u>Creates a Collection and populates it with Subs created from the provided images</u>. <i>images</i> must all be 8bppIndexed, 640x480 max. Initialized as ImageType.Transparent. If a Blended type is desired, change Type and SetTransparencyMask( )<br>
<i>groupID</i> - ID value of the parent Group<br>
<i>images</i> - Images from which to create the Subs<br>
<b>Exceptions</b><br>
<i>System.ArgumentException</i> - <i>images</i> are not all not 8bppIndexed<br>
<i>Idmr.Common.BoundaryException</i> - <i>images</i> do not all meet allowable dimensions</p>

<p><img src="images/meth.gif"> <span><b>public</b></span> SubCollection(DatFile.<span>Sub</span>[] subs)<br>
<u>Creates a Collection and populates it with the provided Subs</u>. GroupID defined by first Sub. Subs will be sorted by ascending SubID<br>
<i>subs</i> - Initial Subs</p>

<h3>Methods</h3>

<p><img src="images/meth.gif"> <span><b>public</b> int</span> Add(<span>short</span> subID)<br>
<u>Adds an empty Sub. Returns the index of the Sub within the Collection</u>. Sub is added and then the Collection is sorted by ascending ID<br>
<i>subID</i> - ID value for the new Sub<br>
<b>Exceptions</b><br>
<i>System.ArgumentException</i> - <i>subID</i> is already in use</p>

<p><img src="images/meth.gif"> <span><b>public</b> int</span> Add(<span>short</span> subID, System.Drawing.<span>Bitmap</span> image)<br>
<u>Adds a new Sub with the provided image. Returns the index of the Sub within the Collection</u>. Sub is added and then the Collection is sorted by ascending SubID<br>
<i>subID</i> - ID value for the new Sub<br>
<i>image</i> - Image to be used, must be 8bppIndexed<br>
<b>Exceptions</b><br>
<i>System.ArgumentException</i> - <i>image</i> is not formatted properly or <i>subID</i> is already in use<br>
<i>Idmr.Common.BoundaryException</i> - <i>image</i> exceeds allowable dimensions</p>

<p><img src="images/meth.gif"> <span><b>public</b> int</span> Add(DatFile.<span>Sub</span> sub)<br>
<u>Adds a Sub to the Collection. Returns the index of the Sub within the Collection</u>. Sub is added with the Collection's GroupID and then the Collection is sorted by ascending SubID<br>
<i>sub</i> - Sub to be added<br>
<b>Exceptions</b><br>
<i>System.ArgumentException</i> - <i>subID</i> is already in use</p>

<p><img src="images/meth.gif"> <span><b>public</b> void</span> Clear( )<br>
<u>Empties the Collection of entries</u>. All existing Subs are lost, Count is set to zero</p>

<p><img src="images/meth.gif"> <span><b>public</b> bool</span> Remove(<span>int</span> index)<br>
<u>Deletes the specified Sub from the Collection. Returns <i>true</i> if successful, <i>false</i> for invalid <i>index</i> value</u>. If only Sub is specified, executes Clear( )<br>
<i>index</i> - Sub index</p>

<p><img src="images/meth.gif"> <span><b>public</b> bool</span> RemoveById(<span>short</span> subID)<br>
<u>Deletes the Sub with the specified ID. Returns <i>true</i> if successful, <i>false</i> for invalid <i>subID</i> value</u>. If only Sub is specified, executes Clear( )<br>
<i>subID</i> - The ID of the Sub to be deleted</p>

<p><img src="images/meth.gif"> <span><b>public</b> int</span> SetSubID(<span>short</span> subID, <span>short</span> newID)<br>
<u>Updates the Sub.ID. Returns the index of the updated Sub within the Collection</u>. Sub.ID is updated and then the Collection is sorted by ascending ID. This is the preferred method for updating Sub IDs<br>
<i>subID</i> - The existing Sub.ID<br>
<i>newID</i> - The new Sub.ID<br>
<b>Exceptions</b><br>
<i>System.ArgumentException</i> - <i>newID</i> is already in use or <i>subID</i> does not exist</p>

<p><img src="images/meth.gif"> <span><b>public</b> int</span> GetIndex(<span>short</span> subID)<br>
<u>Gets the Collection index of the Sub with the provided ID. Returns Collection index if <i>subID</i> exists, otherwise -1</u><br>
<i>subID</i> - Sub ID value</p>

<h3>Properties</h3>

<p><img src="images/prop.gif"> <span><b>public</b></span> DatFile.<span>Sub <b>this</b></span>[<span>int</span> index]<br>
<u>A single Sub within the Collection</u></p>

<p><img src="images/prop.gif"> <span><b>public</b> int</span> Count<br>
<u>Gets the number of objects in the Collection</u></p>

<p><img src="images/prop.gif"> <span><b>public</b> int</span> NumberOfColors<br>
<u>Gets the total number of colors defined in the Collection</u>. Equals the sum of <i>Sub[].NumberOfColors</i> values</p>

<p><img src="images/prop.gif"> <span><b>public</b> short</span> GroupID<br>
<u>Gets or sets the ID value of the defined parent Group</u></p>
</div>
<hr>

Copyright (C) 2009-2011 Michael Gaisser (mjgaisser@gmail.com)<BR><BR>
This library is free software, distributed under the <a href="http://www.gnu.org/licenses/gpl.html" target=_blank>GNU General Public License</a>.<br>
This documentation and items contained herein are distributed under the <a href="http://www.gnu.org/licenses/fdl.html" target=_blank>GNU Free Documentation License</a>.<br>
Publish date: 28 Nov 2011
<HR>
</BODY>
</HTML>